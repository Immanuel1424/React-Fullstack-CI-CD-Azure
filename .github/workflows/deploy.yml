- name: Configure SSH Access
  run: |
    mkdir -p ~/.ssh
    echo "$SSH_KEY" > ~/.ssh/cft.pem
    chmod 600 ~/.ssh/cft.pem

    # Debug step to check PEM formatting
    echo "🔍 First few lines of PEM:"
    head -n 5 ~/.ssh/cft.pem
    echo "🔍 File type:"
    file ~/.ssh/cft.pem

    # Pre-accept host keys
    ssh-keyscan -H $PUBLIC_IP >> ~/.ssh/known_hosts
    ssh-keyscan -H $PRIVATE_IP >> ~/.ssh/known_hosts

    # Test connection to public instance
    ssh -i ~/.ssh/cft.pem -o ConnectTimeout=5 $SSH_USER@$PUBLIC_IP "echo 'Public instance connection successful'"
